DROP VIEW EXTERNALONDEMANDBALANCING;

/* Formatted on 6/19/2022 4:54:55 PM (QP5 v5.256.13226.35538) */
CREATE OR REPLACE FORCE VIEW EXTERNALONDEMANDBALANCING
(
   ACCCODE,
   ACCCURRENTBALANCE
)
   BEQUEATH DEFINER
AS
   SELECT ac.CODE ACCCODE, cb.CURRENT_BALANCE ACCCURRENTBALANCE
     FROM NG_ACCOUNTS ac, Accounts tac, NG_CASA_BALANCES cb
    WHERE     cb.ACCOUNT_ID = ac.ID
          AND AC.CODE = TAC.ACCNO
          AND TAC.DISCRIMINATOR = 'V';

--------------------------------------------------------------------------------------------


DROP VIEW EXTERNATERMDEPBALANCING;

/* Formatted on 6/19/2022 5:02:53 PM (QP5 v5.256.13226.35538) */
CREATE OR REPLACE FORCE VIEW EXTERNATERMDEPBALANCING
(
   ACCCODE,
   ACCNAME,
   ACCTIVATION_DATE,
   RENEW_DATE,
   EXPIRE_DATE,
   PROFITRATE,
   ACCCURRENTBALANCE,
   TENURECOUNT,
   TENURETYPE
)
   BEQUEATH DEFINER
AS
   SELECT NA.CODE AS ACCCODE,
          NA.NAME AS ACCNAME,
          MA.ACTIVATION_DATE AS ACCTIVATION_DATE,
          MA.RENEWAL_DATE AS RENEW_DATE,
          MA.EXPIRY_DATE + 1 AS EXPIRE_DATE,
          GET_MTDR_ACC_PROFIT_RATE (NA.CODE) * 100 AS PROFITRATE,
          MB.BALANCE AS ACCCURRENTBALANCE,
          MA.TENOR AS TENURECOUNT,
          MA.TENOR_TYPE AS TENURETYPE
     FROM NG_ACCOUNTS NA,
          NG_MTDR_BALANCES MB,
          NG_MTDR_ACCOUNTS MA,
          ACCOUNTS TAC
    WHERE     MA.ACCOUNT_ID = NA.ID
          AND MB.ACCOUNT_ID = MA.ACCOUNT_ID
          AND NA.CODE = TAC.ACCNO
          AND TAC.DISCRIMINATOR = 'D';
